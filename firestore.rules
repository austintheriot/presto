rules_version = '2';
service cloud.firestore {

//(read operations === get, list)
//(write operations === create, update, delete)

  match /databases/{database}/documents {
  	//disable all read/writes for the database by default
  	match /{docuemnt=**}{
    	allow read, write: if false;
    }
    match /users/{userId} {
    	//allow any authenticated user to see profile info
    	allow read: if request.auth != null;
      //allow only authenticated users to edit their own profile info
      allow write: if request.auth != null 
      	&& request.auth.uid == userId;
  	}
    match /posts/{document} {
    	//any authenticated user can read posts
      allow read: if request.auth != null;
      //allow only authenticated users to create & edit their own posts
      allow create: if request.auth != null 
      	&& request.auth.uid == request.resource.data.uid; //queries the uid-to-be
      allow update, delete: if request.auth != null 
      	&& request.auth.uid == resource.data.uid; //queries the existing uid
    
    	match /{subcollection}/{docId} { //likes/comments
      	//nobody can directly read raw like/comment documents by default
      	//allow only authenticated users to edit their own likes/comments
        allow create: if request.auth != null 
        	&& request.auth.uid == request.resource.data.uid; //queries the uid-to-be
        allow update, delete: if request.auth != null 
        	&& request.auth.uid == resource.data.uid; //queries the existing uid
      }
    }
  }
}